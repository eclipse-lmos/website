"use strict";(self.webpackChunklmos_website=self.webpackChunklmos_website||[]).push([[3080],{8956:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"arc/dsl/defining_agents","title":"Defining Agents","description":"Agents are defined using the Arc Agent DSL.","source":"@site/docs/arc/01-dsl/defining_agents.md","sourceDirName":"arc/01-dsl","slug":"/arc/dsl/defining_agents","permalink":"/lmos/docs/arc/dsl/defining_agents","draft":false,"unlisted":false,"editUrl":"https://github.com/eclipse-lmos/website/edit/source/docs/arc/01-dsl/defining_agents.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Defining Agents","sidebar_position":1},"sidebar":"arcSidebar","previous":{"title":"Agent DSL","permalink":"/lmos/docs/arc/dsl/"},"next":{"title":"Glossary","permalink":"/lmos/docs/arc/dsl/gloassary"}}');var s=t(4848),r=t(8453);const l={title:"Defining Agents",sidebar_position:1},o=void 0,c={},a=[{value:"Overview",id:"overview",level:3},{value:"Prompt templating",id:"prompt-templating",level:3},{value:"OnFail",id:"onfail",level:3}];function d(e){const n={a:"a",code:"code",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Agents are defined using the Arc Agent DSL."}),"\n",(0,s.jsx)(n.p,{children:"Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kts",children:'agent {\n    name = "weather"\n    description = "Agent that provides weather data."\n    model { "gemma:7b" }\n    prompt { """\n       You are a professional weather service.\n       You have access to real-time weather data with the get_weather function.\n       Keep your answer short and concise.\n       All you require is the location.\n       if you cannot help the user, simply reply "I cant help you"\n     """\n    }\n    tools {\n        +"get_weather"\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Name"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"name"}),(0,s.jsx)(n.td,{children:"The name of the Agent. This should be a unique identifier. Preferably without special characters."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"model"}),(0,s.jsx)(n.td,{children:"The model that should be provided to the Agent."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"description"}),(0,s.jsx)(n.td,{children:"A short description of what the Agent does."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"prompt"}),(0,s.jsxs)(n.td,{children:["The System Prompt of the Agent. The ",(0,s.jsx)(n.code,{children:"prompt"})," defines the core objective, goals and instructions for Agents."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"tools"}),(0,s.jsxs)(n.td,{children:["A list of tools/functions that the Agent uses, ",(0,s.jsx)(n.a,{href:"../defining_functions",children:"see"}),"."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"filterInput"}),(0,s.jsxs)(n.td,{children:["Defines filter logic, ",(0,s.jsx)(n.a,{href:"../filters",children:"see"}),"."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"filterOutput"}),(0,s.jsxs)(n.td,{children:["Defines filter logic, ",(0,s.jsx)(n.a,{href:"../filters",children:"see"}),"."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"limit"}),(0,s.jsxs)(n.td,{children:["Defines a rate limiter, ",(0,s.jsx)(n.a,{href:"../Features/rate_limiter",children:"see"}),"."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"onFail"}),(0,s.jsxs)(n.td,{children:["Called when the Agent encounters an Exception, ",(0,s.jsx)(n.a,{href:"#onfail",children:"see"}),"."]})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"See the following pages on how to load the agents into your application."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/arc/manual_setup",children:"Manual Setup"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/arc/spring/agent-beans",children:"Spring Boot Beans"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"prompt-templating",children:"Prompt templating"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"prompt"})," function of an Agent is called on each request.\nMeaning that it can be dynamically customized to best suit the current context.\nNow although Kotlin Strings are quite powerful,\nadding logical constructs such as ",(0,s.jsx)(n.code,{children:"if"})," and ",(0,s.jsx)(n.code,{children:"for loops"})," statements can be cumbersome."]}),"\n",(0,s.jsxs)(n.p,{children:["For this purpose, the Arc DSL overwrites the UnaryPlus operator, ",(0,s.jsx)(n.code,{children:"+"}),", within the ",(0,s.jsx)(n.code,{children:"prompt"})," block\nto allow for simple string concatenation."]}),"\n",(0,s.jsxs)(n.p,{children:["For example, the following code snippet shows how to use the ",(0,s.jsx)(n.code,{children:"+"})," operator to build a dynamic prompt."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kts",children:'agent {\n    prompt {\n        +"Here is the first part og the prompt."\n        if(someCondition) {\n            +"Here is a conditional part of the prompt."\n        }\n      "The last part of the prompt (this does not require a + because it is automatically returned)."\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"onfail",children:"OnFail"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"onFail"})," property allows you to define custom error handling behavior for your agent.\nWhen an agent encounters an exception during execution, the code defined in the ",(0,s.jsx)(n.code,{children:"onFail"})," block will be executed."]}),"\n",(0,s.jsx)(n.p,{children:"This is particularly useful for:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Providing fallback responses when the agent fails"}),"\n",(0,s.jsx)(n.li,{children:"Implementing retry mechanisms"}),"\n",(0,s.jsx)(n.li,{children:"Gracefully handling expected exceptions"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kts",children:'agent {\n    name = "weather"\n    onFail { \n        if (condition) {\n            retry(mapOf("key", "data"))\n        } else if (anotherCondition) {\n            AssistantMessage("New message!")\n        } else null\n    }\n    prompt {\n        val retry = getOptional<RetrySignal>()\n        if (retry != null) {\n            // The details provided to the retry function can be accessed here.\n            """ Updated Instructions with ${retry.details}"""\n        } else {\n            """ Instructions """\n        }\n    }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"onFail"})," block receives the exception that was thrown as a parameter,\nallowing you to inspect the error and respond accordingly."]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"onFail"})," block can either:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"return an AssistantMessage which will be returned to the client as if the agent executed successfully."}),"\n",(0,s.jsx)(n.li,{children:"return null in which case the agent will rethrow the exception."}),"\n",(0,s.jsxs)(n.li,{children:["call the ",(0,s.jsx)(n.code,{children:"retry"})," function which will cause the agent to be re-run."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["When the ",(0,s.jsx)(n.code,{children:"retry"})," function is called, the agent will be executed with the same parameters and state as the original run,\nwith the only difference being that an instance of ",(0,s.jsx)(n.code,{children:"RetrySignal"})," will be added to the context."]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"RetrySignal"})," bean can be accessed with the ",(0,s.jsx)(n.code,{children:"get"})," function\nand will contain the map of details provided to the ",(0,s.jsx)(n.code,{children:"retry"})," function."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Warning:"})," There is no safety net for infinite loops! You should check the ",(0,s.jsx)(n.code,{children:"RetrySignal.count"}),"\nfield to check for the current retry count."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>o});var i=t(6540);const s={},r=i.createContext(s);function l(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);