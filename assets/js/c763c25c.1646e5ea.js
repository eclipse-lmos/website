"use strict";(self.webpackChunklmos_website=self.webpackChunklmos_website||[]).push([[5887],{7868:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"arc/dsl/filters","title":"Filtering Input/Output","description":"The input and output of Agents can be filtered/transformed using the filterInput and filterOutput blocks","source":"@site/docs/arc/01-dsl/filters.md","sourceDirName":"arc/01-dsl","slug":"/arc/dsl/filters","permalink":"/lmos/docs/arc/dsl/filters","draft":false,"unlisted":false,"editUrl":"https://github.com/eclipse-lmos/website/edit/source/docs/arc/01-dsl/filters.md","tags":[],"version":"current","frontMatter":{"title":"Filtering Input/Output"},"sidebar":"arcSidebar","previous":{"title":"Defining Functions","permalink":"/lmos/docs/arc/dsl/defining_functions"},"next":{"title":"Quickstart","permalink":"/lmos/docs/arc/quickstart"}}');var r=t(4848),i=t(8453);const l={title:"Filtering Input/Output"},a=void 0,d={},o=[{value:"Overriding In/Output",id:"overriding-inoutput",level:3},{value:"The breakWith function",id:"the-breakwith-function",level:3},{value:"Running Filters in Parallel",id:"running-filters-in-parallel",level:3},{value:"Replacing values",id:"replacing-values",level:3},{value:"Removing values",id:"removing-values",level:3},{value:"Custom Filter classes",id:"custom-filter-classes",level:3}];function c(e){const n={code:"code",h3:"h3",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["The input and output of Agents can be filtered/transformed using the ",(0,r.jsx)(n.code,{children:"filterInput"})," and ",(0,r.jsx)(n.code,{children:"filterOutput"})," blocks\nrespectively."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"FilterInput"}),"\nThe filterInput blocks have access to the following fields:"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Name"}),(0,r.jsx)(n.th,{}),(0,r.jsx)(n.th,{}),(0,r.jsx)(n.th,{})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"input"}),(0,r.jsx)(n.td,{children:"Conversation"}),(0,r.jsx)(n.td,{children:"The entire conversation."}),(0,r.jsx)(n.td,{children:"writable"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"inputMessage"}),(0,r.jsx)(n.td,{children:"ConversationMessage"}),(0,r.jsx)(n.td,{children:"The latest message of the conversation."}),(0,r.jsx)(n.td,{children:"writable"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"message"}),(0,r.jsx)(n.td,{children:"String"}),(0,r.jsx)(n.td,{children:"The content of the latest message of the conversation."}),(0,r.jsx)(n.td,{children:"writable"})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"FilterOutput"}),"\nThe filterInput blocks have access to the following fields:"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Name"}),(0,r.jsx)(n.th,{}),(0,r.jsx)(n.th,{}),(0,r.jsx)(n.th,{})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"input"}),(0,r.jsx)(n.td,{children:"Conversation"}),(0,r.jsx)(n.td,{children:"The conversation that was provided as input."}),(0,r.jsx)(n.td,{children:"readonly"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"output"}),(0,r.jsx)(n.td,{children:"Conversation"}),(0,r.jsx)(n.td,{children:"The conversation plus the output message."}),(0,r.jsx)(n.td,{children:"writable"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"outputMessage"}),(0,r.jsx)(n.td,{children:"ConversationMessage"}),(0,r.jsx)(n.td,{children:"The message generated by the Agent."}),(0,r.jsx)(n.td,{children:"writable"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"message"}),(0,r.jsx)(n.td,{children:"String"}),(0,r.jsx)(n.td,{children:"The content of message generated by the Agent."}),(0,r.jsx)(n.td,{children:"writable"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"overriding-inoutput",children:"Overriding In/Output"}),"\n",(0,r.jsxs)(n.p,{children:["Filters can be used change the input and output of the conversation.\nSimply assign a new value to one of the message fields,\ni.e. ",(0,r.jsx)(n.code,{children:"message"}),", ",(0,r.jsx)(n.code,{children:"inputMessage"}),", ",(0,r.jsx)(n.code,{children:"outputMessage"}),", ",(0,r.jsx)(n.code,{children:"input"}),", or ",(0,r.jsx)(n.code,{children:"output"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kts",children:'agent {\n    name = "weather"\n    description = "Agent that provides weather data."\n    prompt { """ Some system prompt """ }\n    filterInput {\n        message = "This is the input message $message"\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"the-breakwith-function",children:"The breakWith function"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"breakWith"})," function can be used to stop the agent from further\nprocessing the message and a return a dedicated response.\nThis is similar to the throwing an exception with the difference\nthat the Agent does not fail, but instead returns the provided message."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kts",children:'agent {\n    name = "weather"\n    description = "Agent that provides weather data."\n    prompt { """ Some system prompt """ }\n    filterInput {\n        val eval = llm("""\n          Evaluate if the following input is referring to bananas. \n          If so return BANANAS otherwise return CONTINUE.\n          Input: $message""").getOrNull()\n\n        if ("BANANAS" == eval?.content) {\n            breakWith("I cannot answer questions about bananas...")\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"running-filters-in-parallel",children:"Running Filters in Parallel"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"runAsync"})," function can be used to run one or more filters in parallel."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kts",children:'agent {\n    name = "weather"\n    description = "Agent that provides weather data."\n    prompt { """ Some system prompt """ }\n    filterInput {\n        runAsync { +MyFilter() }\n        runAsync { +MySecondFilter() }\n    }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Caution"}),": The ",(0,r.jsx)(n.code,{children:"runAsync"})," function should only be used with filters that do not try to modify the Conversation as\nthis will have unpredictable results."]}),"\n",(0,r.jsx)(n.h3,{id:"replacing-values",children:"Replacing values"}),"\n",(0,r.jsxs)(n.p,{children:["Within the filter blocks the keyword ",(0,r.jsx)(n.code,{children:"replaces"})," can be used to replace\noccurrences of values with new values."]}),"\n",(0,r.jsx)(n.p,{children:"Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kts",children:'agent {\n    name = "weather"\n    description = "Agent that provides weather data."\n    prompt { """ Some system prompt """ }\n    filterInput {\n        "A transformed question" replaces "A question"\n        "A new message replacing the old" replaces ".*".toRegex()\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"removing-values",children:"Removing values"}),"\n",(0,r.jsxs)(n.p,{children:["Within the filter blocks the unaryMinus on String and Regex ",(0,r.jsx)(n.code,{children:"-"})," can be used to remove\nvalues."]}),"\n",(0,r.jsx)(n.p,{children:"Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kts",children:'agent {\n    name = "weather"\n    description = "Agent that provides weather data."\n    prompt { """ Some system prompt """ }\n    filterInput {\n        -"Bad Word"\n        -"Malware.*".toRegex()\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"custom-filter-classes",children:"Custom Filter classes"}),"\n",(0,r.jsxs)(n.p,{children:["Sometimes filter logic can be complex, or you may wish to reuse filters. In these cases, the ",(0,r.jsx)(n.code,{children:"AgentFilter"}),"\ninterface can be used."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kt",children:"fun interface AgentFilter {\n    /**\n     * Filters or transform Conversation Messages.\n     * If the fun returns null, the message will be removed from the conversation transcript.\n     */\n    suspend fun filter(message: ConversationMessage): ConversationMessage?\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Any ",(0,r.jsx)(n.code,{children:"AgentFilter"})," implementation on the classpath, can be added to the ",(0,r.jsx)(n.code,{children:"filterInput"})," and ",(0,r.jsx)(n.code,{children:"filterOutput"})," blocks using\nthe UnaryPlus ",(0,r.jsx)(n.code,{children:"+"})," operator."]}),"\n",(0,r.jsxs)(n.p,{children:["For example, adding a custom filter class ",(0,r.jsx)(n.code,{children:"MyFilter"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kts",children:'agent {\n    name = "weather"\n    description = "Agent that provides weather data."\n    prompt { """ Some system prompt """ }\n    filterInput {\n        +MyFilter::class // context is used to lookup instance of MyFilter\n        +MyFilter() // MyFilter is directly instantiated\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Filters can be directly instantiated in the filter blocks, or if the filter class is provided,\nthen a matching bean will be retrieved from the context, for example, the Spring Boot container."})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>a});var s=t(6540);const r={},i=s.createContext(r);function l(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);